<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IPTV è³‡æºç®¡ç†ä¸­å¿ƒ</title>
    <style>
        :root { --bg: #f5f7fa; --card: #ffffff; --primary: #0070f3; --text: #333; --secondary: #666; --border: #eee; }
        body.dark-mode { --bg: #121212; --card: #1e1e1e; --primary: #3291ff; --text: #e0e0e0; --secondary: #aaa; --border: #333; }
        body { font-family: system-ui, -apple-system, sans-serif; background: var(--bg); margin: 0; padding: 20px; color: var(--text); transition: 0.3s; }
        header { text-align: center; padding: 10px 0; position: relative; }
        #themeToggle { position: absolute; right: 0; top: 10px; cursor: pointer; background: var(--card); border: 1px solid var(--border); padding: 5px 10px; border-radius: 15px; color: var(--text); font-size: 12px; }
        .controls { max-width: 800px; margin: 0 auto 30px; display: flex; gap: 10px; flex-wrap: wrap; }
        #searchInput { flex: 1; min-width: 150px; padding: 10px; border-radius: 8px; border: 1px solid var(--border); background: var(--card); color: var(--text); outline: none; }
        #sortSelect { padding: 10px; border-radius: 8px; border: 1px solid var(--border); background: var(--card); color: var(--text); }
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); gap: 15px; max-width: 1200px; margin: 0 auto; }
        .card { background: var(--card); border-radius: 10px; padding: 12px; display: flex; flex-direction: column; border: 1px solid var(--border); box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .img-box { height: 100px; display: flex; align-items: center; justify-content: center; background: rgba(128,128,128,0.1); border-radius: 6px; margin-bottom: 8px; font-size: 40px; overflow: hidden; }
        .img-box img { width: 100%; height: 100%; object-fit: contain; }
        .name { font-size: 13px; font-weight: 600; margin-bottom: 5px; word-break: break-all; min-height: 2.8em; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }
        .info { font-size: 10px; color: var(--secondary); margin-bottom: 10px; }
        .btn-group { display: flex; gap: 5px; margin-top: auto; }
        .copy-btn { flex: 2; background: var(--primary); color: white; border: none; padding: 8px; border-radius: 5px; cursor: pointer; font-size: 12px; }
        .dl-btn { flex: 1; background: #34c759; color: white; border: none; padding: 8px; border-radius: 5px; text-decoration: none; text-align: center; font-size: 12px; }
        #toast { position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%); background: #333; color: white; padding: 10px 20px; border-radius: 20px; display: none; z-index: 100; }
        .loading { text-align: center; grid-column: 1 / -1; padding: 50px; }
    </style>
</head>
<body>

<header>
    <h1>ğŸ“º IPTV è³‡æºç®¡ç†</h1>
    <button id="themeToggle">ğŸŒ“ åˆ‡æ›æ¨¡å¼</button>
</header>

<div class="controls">
    <input type="text" id="searchInput" placeholder="æœå°‹æª”å...">
    <select id="sortSelect">
        <option value="name-asc">åç¨± (A-Z)</option>
        <option value="size-desc">å¤§å° (å¤§â†’å°)</option>
    </select>
</div>

<div class="grid" id="iconGrid"><div class="loading">æ­£åœ¨è¼‰å…¥è³‡æº...</div></div>
<div id="toast">âœ… å·²è¤‡è£½ç¶²å€</div>

<script>
    const githubUser = "161161on88"; 
    const repoName = "icons";
    let allFiles = [];

    // ä¸»é¡Œåˆ‡æ›é‚è¼¯
    const themeBtn = document.getElementById('themeToggle');
    themeBtn.onclick = () => {
        document.body.classList.toggle('dark-mode');
        localStorage.setItem('iptv-theme', document.body.classList.contains('dark-mode') ? 'dark' : 'light');
    };
    if(localStorage.getItem('iptv-theme') === 'dark') document.body.classList.add('dark-mode');

    // å–å¾—æª”æ¡ˆåˆ—è¡¨
    async function fetchFiles() {
        try {
            // ä½¿ç”¨ GitHub API ç²å–æª”æ¡ˆè³‡è¨Š
            const res = await fetch(`https://api.github.com/repos/${githubUser}/${repoName}/contents/`);
            if (!res.ok) throw new Error(res.status === 403 ? "GitHub API é™åˆ¶ï¼Œè«‹ç¨å¾Œå†è©¦" : "è®€å–å¤±æ•—");
            const data = await res.json();
            
            // éæ¿¾æ‰ html, md æª”æ¡ˆï¼Œä¸¦æå–æ‰€éœ€è³‡è¨Š
            allFiles = data.filter(f => !/\.(html|md)$/i.test(f.name) && !f.name.startsWith('.'))
                           .map(f => ({
                               name: f.name,
                               size: (f.size / 1024).toFixed(1),
                               isImage: /\.(png|jpe?g|gif|svg|webp)$/i.test(f.name),
                               downloadUrl: f.download_url // é€™æ˜¯é—œéµï¼šä½¿ç”¨ raw.githubusercontent.com é€£çµ
                           }));
            renderFiles();
        } catch (e) {
            document.getElementById('iconGrid').innerHTML = `<div class="loading">âŒ ${e.message}</div>`;
        }
    }

    // æ ¹æ“šå‰¯æª”åè¿”å›åœ–ç¤º
    function getFileIcon(n) {
        const e = n.split('.').pop().toLowerCase();
        if(['mp4','mkv','mov'].includes(e)) return 'ğŸ¬';
        if(['m3u','m3u8'].includes(e)) return 'ğŸ“‚';
        if(['apk'].includes(e)) return 'ğŸ¤–';
        return 'ğŸ“„';
    }

    // æ¸²æŸ“ç•«é¢
    function renderFiles() {
        const search = document.getElementById('searchInput').value.toLowerCase();
        const sort = document.getElementById('sortSelect').value;
        
        let filtered = allFiles.filter(f => f.name.toLowerCase().includes(search));
        
        if(sort === 'name-asc') filtered.sort((a,b) => a.name.localeCompare(b.name, undefined, {numeric: true, sensitivity: 'base'}));
        if(sort === 'size-desc') filtered.sort((a,b) => b.size - a.size);

        const grid = document.getElementById('iconGrid');
        grid.innerHTML = filtered.length ? '' : '<div class="loading">ç„¡åŒ¹é…æª”æ¡ˆ</div>';
        
        filtered.forEach(f => {
            const url = f.downloadUrl; 
            const card = document.createElement('div');
            card.className = 'card';
            card.innerHTML = `
                <div class="img-box">
                    ${f.isImage ? `<img src="${url}" loading="lazy" alt="${f.name}">` : getFileIcon(f.name)}
                </div>
                <div class="name" title="${f.name}">${f.name}</div>
                <div class="info">ğŸ“ ${f.size} KB</div>
                <div class="btn-group">
                    <button class="copy-btn" onclick="copyUrl('${url}')">è¤‡è£½</button>
                    <a href="${url}" target="_blank" download class="dl-btn">â¬‡ï¸</a>
                </div>
            `;
            grid.appendChild(card);
        });
    }

    // è¤‡è£½åŠŸèƒ½
    function copyUrl(u) {
        navigator.clipboard.writeText(u).then(() => {
            const t = document.getElementById('toast');
            t.style.display='block'; 
            setTimeout(()=>t.style.display='none', 2000);
        });
    }

    // ç›£è½æœå°‹èˆ‡æ’åº
    document.getElementById('searchInput').oninput = renderFiles;
    document.getElementById('sortSelect').onchange = renderFiles;

    // å•Ÿå‹•
    fetchFiles();
</script>
</body>
</html>
