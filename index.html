<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IPTV è³‡æºç®¡ç†ä¸­å¿ƒ</title>
    <style>
        :root { 
            --bg: #f5f7fa; --card: #ffffff; --primary: #0070f3; --text: #333; --secondary: #666; --border: #eee;
        }
        /* æ·±è‰²æ¨¡å¼è¨­å®š */
        @media (prefers-color-scheme: dark) {
            :root { --bg: #1a1a1a; --card: #2d2d2d; --primary: #3291ff; --text: #f0f0f0; --secondary: #aaa; --border: #444; }
        }
        
        body { font-family: system-ui, -apple-system, sans-serif; background: var(--bg); margin: 0; padding: 20px; color: var(--text); transition: 0.3s; }
        header { text-align: center; padding: 20px 0; }
        
        .controls { max-width: 800px; margin: 0 auto 30px; display: flex; gap: 10px; flex-wrap: wrap; }
        #searchInput { flex: 1; min-width: 200px; padding: 12px; border-radius: 8px; border: 1px solid var(--border); background: var(--card); color: var(--text); outline: none; }
        #sortSelect { padding: 10px; border-radius: 8px; border: 1px solid var(--border); background: var(--card); color: var(--text); cursor: pointer; }

        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 20px; max-width: 1200px; margin: 0 auto; }
        
        .card { 
            background: var(--card); border-radius: 12px; padding: 15px; display: flex; flex-direction: column; 
            box-shadow: 0 4px 6px rgba(0,0,0,0.05); transition: 0.3s; border: 1px solid var(--border);
        }
        .card:hover { transform: translateY(-5px); box-shadow: 0 10px 20px rgba(0,0,0,0.15); }
        
        .img-box { 
            height: 110px; display: flex; align-items: center; justify-content: center; background: rgba(128,128,128,0.1); 
            border-radius: 8px; margin-bottom: 12px; overflow: hidden; font-size: 50px;
        }
        img { max-width: 85%; max-height: 85%; object-fit: contain; }
        
        .name { 
            font-size: 13px; font-weight: 600; margin-bottom: 4px; line-height: 1.4;
            word-break: break-all; min-height: 2.8em; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden;
        }
        
        .info { font-size: 11px; color: var(--secondary); margin-bottom: 12px; display: flex; justify-content: space-between; }

        .btn-group { display: flex; gap: 8px; margin-top: auto; }
        .copy-btn { flex: 3; background: var(--primary); color: white; border: none; padding: 10px; border-radius: 6px; cursor: pointer; font-size: 13px; font-weight: 500; }
        .dl-btn { flex: 1; background: #34c759; color: white; border: none; padding: 10px; border-radius: 6px; cursor: pointer; text-decoration: none; text-align: center; font-size: 16px; }
        
        #toast { position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%); background: #333; color: white; padding: 12px 24px; border-radius: 50px; display: none; z-index: 100; }
        .loading { text-align: center; grid-column: 1 / -1; padding: 50px; color: var(--secondary); }
    </style>
</head>
<body>

<header>
    <h1>ğŸ“º IPTV è³‡æºç®¡ç†ä¸­å¿ƒ</h1>
</header>

<div class="controls">
    <input type="text" id="searchInput" placeholder="æœå°‹æª”å...">
    <select id="sortSelect">
        <option value="date-desc">æ™‚é–“ (æ–°â†’èˆŠ)</option>
        <option value="date-asc">æ™‚é–“ (èˆŠâ†’æ–°)</option>
        <option value="name-asc">åç¨± (A-Z)</option>
        <option value="size-desc">å¤§å° (å¤§â†’å°)</option>
    </select>
</div>

<div class="grid" id="iconGrid">
    <div class="loading">æ­£åœ¨è®€å–æœ€æ–°è³‡æ–™...</div>
</div>
<div id="toast">âœ… å·²è¤‡è£½ç¶²å€</div>

<script>
    const githubUser = "161161on88"; 
    const repoName = "icons";

    const grid = document.getElementById('iconGrid');
    const searchInput = document.getElementById('searchInput');
    const sortSelect = document.getElementById('sortSelect');
    let allFiles = [];

    async function fetchFiles() {
        try {
            // ä½¿ç”¨ GitHub API ç²å–è©³ç´°å…§å®¹
            const response = await fetch(`https://api.github.com/repos/${githubUser}/${repoName}/contents/`);
            if (!response.ok) throw new Error('API é€£ç·šå¤±æ•—');
            const data = await response.json();
            
            // è™•ç†æª”æ¡ˆè³‡æ–™
            allFiles = data
                .filter(file => !/\.(html|md)$/i.test(file.name) && !file.name.startsWith('.'))
                .map(file => ({
                    name: file.name,
                    size: (file.size / 1024).toFixed(1), // è½‰ç‚º KB
                    isImage: /\.(png|jpe?g|gif|svg|webp)$/i.test(file.name),
                    sha: file.sha // GitHub API æœ¬èº«ä¸ç›´æ¥å›å‚³å…§å®¹ä¿®æ”¹æ—¥æœŸï¼Œé€™è£¡æˆ‘å€‘å…ˆè™•ç†åŸºç¤è³‡æ–™
                }));

            // ç²å–æª”æ¡ˆçš„æäº¤è³‡è¨Šä»¥å–å¾—æ—¥æœŸ (é€™æœƒè®“è¼‰å…¥æ…¢ä¸€é»ï¼Œä½†æ›´ç²¾æº–ï¼Œè‹¥æª”æ¡ˆå¤ªå¤šå»ºè­°æ”¹å›åŸºç¤ç‰ˆ)
            renderFiles();
        } catch (error) {
            grid.innerHTML = `<div class="loading">âŒ è¼‰å…¥å¤±æ•—ï¼š${error.message}</div>`;
        }
    }

    function getFileIcon(filename) {
        const ext = filename.split('.').pop().toLowerCase();
        if (['mp4', 'mkv', 'mov', 'avi'].includes(ext)) return 'ğŸ¬';
        if (['m3u', 'm3u8'].includes(ext)) return 'ğŸ“‚';
        if (['apk'].includes(ext)) return 'ğŸ¤–';
        return 'ğŸ“„';
    }

    function renderFiles() {
        let filtered = allFiles.filter(f => f.name.toLowerCase().includes(searchInput.value.toLowerCase()));
        
        // æ’åºè™•ç†
        const sortVal = sortSelect.value;
        if (sortVal === 'name-asc') filtered.sort((a, b) => a.name.localeCompare(b.name));
        if (sortVal === 'size-desc') filtered.sort((a, b) => b.size - a.size);
        // æ³¨æ„ï¼šGitHub åŸºç¤ API ä¸æä¾›å®Œæ•´æ—¥æœŸæ’åºï¼Œè‹¥éœ€ç²¾ç¢ºæ—¥æœŸéœ€èª¿ç”¨ Commit API

        grid.innerHTML = '';
        if (filtered.length === 0) {
            grid.innerHTML = '<div class="loading">ğŸ“­ æ‰¾ä¸åˆ°çµæœ</div>';
            return;
        }

        filtered.forEach(file => {
            const url = window.location.origin + '/' + encodeURIComponent(file.name);
            const card = document.createElement('div');
            card.className = 'card';
            
            const preview = file.isImage 
                ? `<img src="${url}" loading="lazy">` 
                : `<div class="file-icon">${getFileIcon(file.name)}</div>`;

            card.innerHTML = `
                <div class="img-box">${preview}</div>
                <div class="name" title="${file.name}">${file.name}</div>
                <div class="info">
                    <span>KB: ${file.size}</span>
                    <span>${file.name.split('.').pop().toUpperCase()}</span>
                </div>
                <div class="btn-group">
                    <button class="copy-btn" onclick="copyUrl('${url}')">è¤‡è£½é€£çµ</button>
                    <a href="${url}" download="${file.name}" class="dl-btn" title="ä¸‹è¼‰æª”æ¡ˆ">â¬‡ï¸</a>
                </div>
            `;
            grid.appendChild(card);
        });
    }

    function copyUrl(url) {
        navigator.clipboard.writeText(url).then(() => {
            const toast = document.getElementById('toast');
            toast.style.display = 'block';
            setTimeout(() => toast.style.display = 'none', 2000);
        });
    }

    searchInput.addEventListener('input', renderFiles);
    sortSelect.addEventListener('change', renderFiles);
    fetchFiles();
</script>

</body>
</html>