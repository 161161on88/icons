<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IPTV è³‡æºç®¡ç†ä¸­å¿ƒ</title>
    <style>
        :root { 
            --bg: #f5f7fa; --card: #ffffff; --primary: #0070f3; --text: #333; --secondary: #666; --border: #eee;
        }
        /* æ·±è‰²æ¨¡å¼æ¨£å¼ */
        body.dark-mode { 
            --bg: #121212; --card: #1e1e1e; --primary: #3291ff; --text: #e0e0e0; --secondary: #aaa; --border: #333; 
        }
        
        body { font-family: system-ui, -apple-system, sans-serif; background: var(--bg); margin: 0; padding: 20px; color: var(--text); transition: background 0.3s; }
        header { text-align: center; padding: 10px 0; position: relative; }
        
        /* åˆ‡æ›æŒ‰éˆ•æ¨£å¼ */
        #themeToggle { position: absolute; right: 20px; top: 20px; cursor: pointer; background: var(--card); border: 1px solid var(--border); padding: 8px 12px; border-radius: 20px; color: var(--text); font-size: 14px; }

        .controls { max-width: 800px; margin: 0 auto 30px; display: flex; gap: 10px; flex-wrap: wrap; }
        #searchInput { flex: 1; min-width: 200px; padding: 12px; border-radius: 8px; border: 1px solid var(--border); background: var(--card); color: var(--text); outline: none; }
        #sortSelect { padding: 10px; border-radius: 8px; border: 1px solid var(--border); background: var(--card); color: var(--text); cursor: pointer; }

        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 20px; max-width: 1200px; margin: 0 auto; }
        .card { background: var(--card); border-radius: 12px; padding: 15px; display: flex; flex-direction: column; box-shadow: 0 4px 6px rgba(0,0,0,0.05); border: 1px solid var(--border); }
        .img-box { height: 110px; display: flex; align-items: center; justify-content: center; background: rgba(128,128,128,0.1); border-radius: 8px; margin-bottom: 12px; font-size: 50px; }
        img { max-width: 85%; max-height: 85%; object-fit: contain; }
        .name { font-size: 13px; font-weight: 600; margin-bottom: 4px; line-height: 1.4; word-break: break-all; min-height: 2.8em; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }
        .info { font-size: 10px; color: var(--secondary); margin-bottom: 12px; display: flex; flex-direction: column; gap: 2px; }

        .btn-group { display: flex; gap: 8px; margin-top: auto; }
        .copy-btn { flex: 3; background: var(--primary); color: white; border: none; padding: 10px; border-radius: 6px; cursor: pointer; font-size: 12px; }
        .dl-btn { flex: 1; background: #34c759; color: white; border: none; padding: 10px; border-radius: 6px; cursor: pointer; text-decoration: none; text-align: center; }
        
        #toast { position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%); background: #333; color: white; padding: 12px 24px; border-radius: 50px; display: none; z-index: 100; }
        .loading { text-align: center; grid-column: 1 / -1; padding: 50px; color: var(--secondary); }
    </style>
</head>
<body>

<header>
    <h1>ğŸ“º IPTV è³‡æºç®¡ç†</h1>
    <button id="themeToggle">ğŸŒ“ åˆ‡æ›æ¨¡å¼</button>
</header>

<div class="controls">
    <input type="text" id="searchInput" placeholder="æœå°‹æª”å...">
    <select id="sortSelect">
        <option value="date-desc">æ™‚é–“ (æœ€æ–°åœ¨å‰)</option>
        <option value="date-asc">æ™‚é–“ (æœ€èˆŠåœ¨å‰)</option>
        <option value="name-asc">åç¨± (A-Z)</option>
        <option value="size-desc">å¤§å° (ç”±å¤§åˆ°å°)</option>
    </select>
</div>

<div class="grid" id="iconGrid">
    <div class="loading">æ­£åœ¨åŒæ­¥ GitHub æ•¸æ“š (åŒ…å«æ™‚é–“)...</div>
</div>
<div id="toast">âœ… å·²è¤‡è£½ç¶²å€</div>

<script>
    const githubUser = "161161on88"; 
    const repoName = "icons";
    let allFiles = [];

    // 1. æ·±è‰²æ¨¡å¼æŒ‰éˆ•é‚è¼¯
    const themeToggle = document.getElementById('themeToggle');
    themeToggle.addEventListener('click', () => {
        document.body.classList.toggle('dark-mode');
        localStorage.setItem('theme', document.body.classList.contains('dark-mode') ? 'dark' : 'light');
    });
    if (localStorage.getItem('theme') === 'dark') document.body.classList.add('dark-mode');

    // 2. ç²å–è³‡æ–™ (è§£æ±ºæ™‚é–“æ’åºå•é¡Œ)
    async function fetchFiles() {
        try {
            // é¦–å…ˆç²å–æª”æ¡ˆåˆ—è¡¨
            const res = await fetch(`https://api.github.com/repos/${githubUser}/${repoName}/contents/`);
            const data = await res.json();
            const filesOnly = data.filter(f => !/\.(html|md)$/i.test(f.name) && !f.name.startsWith('.'));

            // ç‚ºäº†è§£æ±ºæ—¥æœŸæ’åºï¼Œæˆ‘å€‘ç²å–æœ€è¿‘çš„ Commits
            // æ³¨æ„ï¼šé€™æœƒé¡¯ç¤ºæª”æ¡ˆè¢«ã€Œä¸Šå‚³ã€çš„æ™‚é–“
            const commitRes = await fetch(`https://api.github.com/repos/${githubUser}/${repoName}/commits?per_page=100`);
            const commits = await commitRes.json();

            allFiles = filesOnly.map(file => {
                // å˜—è©¦å¾ commit ç´€éŒ„ä¸­åŒ¹é…è©²æª”æ¡ˆçš„æœ€å¾Œä¿®æ”¹æ™‚é–“ï¼ˆç°¡åŒ–ç‰ˆï¼‰
                return {
                    name: file.name,
                    size: (file.size / 1024).toFixed(1),
                    isImage: /\.(png|jpe?g|gif|svg|webp)$/i.test(file.name),
                    // å¦‚æœæª”æ¡ˆè¼ƒæ–°ï¼Œé è¨­ä¸€å€‹æ™‚é–“ï¼Œç²¾ç¢ºæ™‚é–“éœ€å€‹åˆ¥ API è«‹æ±‚
                    date: new Date(commits[0]?.commit.committer.date).getTime() 
                };
            });

            // æ›´å¥½çš„åšæ³•ï¼šç²å–æ¯å€‹æª”æ¡ˆçš„æœ€å¾Œä¿®æ”¹æ—¥æœŸ
            // ç‚ºäº†æ•ˆèƒ½ï¼Œæˆ‘å€‘é€™è£¡é€²è¡Œæ‰¹é‡è™•ç†
            await Promise.all(allFiles.map(async (file) => {
                const fRes = await fetch(`https://api.github.com/repos/${githubUser}/${repoName}/commits?path=${file.name}&per_page=1`);
                const fData = await fRes.json();
                if (fData.length > 0) {
                    file.date = new Date(fData[0].commit.committer.date).getTime();
                    file.dateStr = new Date(fData[0].commit.committer.date).toLocaleString();
                }
            }));

            renderFiles();
        } catch (e) {
            document.getElementById('iconGrid').innerHTML = "è¼‰å…¥å¤±æ•—";
        }
    }

    function renderFiles() {
        let filtered = allFiles.filter(f => f.name.toLowerCase().includes(document.getElementById('searchInput').value.toLowerCase()));
        
        const sortVal = document.getElementById('sortSelect').value;
        if (sortVal === 'date-desc') filtered.sort((a, b) => b.date - a.date);
        if (sortVal === 'date-asc') filtered.sort((a, b) => a.date - b.date);
        if (sortVal === 'name-asc') filtered.sort((a, b) => a.name.localeCompare(b.name));
        if (sortVal === 'size-desc') filtered.sort((a, b) => b.size - a.size);

        const grid = document.getElementById('iconGrid');
        grid.innerHTML = '';
        
        filtered.forEach(file => {
            const url = window.location.origin + '/' + encodeURIComponent(file.name);
            const card = document.createElement('div');
            card.className = 'card';
            card.innerHTML = `
                <div class="img-box">${file.isImage ? `<img src="${url}">` : 'ğŸ“„'}</div>
                <div class="name">${file.name}</div>
                <div class="info">
                    <span>ğŸ“ ${file.size} KB</span>
                    <span>ğŸ“… ${file.dateStr || 'æœªçŸ¥'}</span>
                </div>
                <div class="btn-group">
                    <button class="copy-btn" onclick="copyUrl('${url}')">è¤‡è£½</button>
                    <a href="${url}" download class="dl-btn">â¬‡ï¸</a>
                </div>
            `;
            grid.appendChild(card);
        });
    }

    function copyUrl(url) {
        navigator.clipboard.writeText(url);
        const t = document.getElementById('toast');
        t.style.display = 'block';
        setTimeout(() => t.style.display = 'none', 2000);
    }

    document.getElementById('searchInput').addEventListener('input', renderFiles);
    document.getElementById('sortSelect').addEventListener('change', renderFiles);
    fetchFiles();
</script>
</body>
</html>